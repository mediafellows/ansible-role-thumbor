---
# vars file for ansible-role-thumbor

# Nginx setup:
nginx_http_params:
  - sendfile on
  - tcp_nopush on
  - tcp_nodelay on
  - keepalive_timeout 65
  - types_hash_max_size 2048
  - ssl_protocols TLSv1 TLSv1.1 TLSv1.2
  - ssl_prefer_server_ciphers on
  - gzip on
  - gzip_disable "msie6"
  - log_format graylog2_format '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for" <msec=$msec|connection=$connection|connection_requests=$connection_requests|millis=$request_time>'
  - access_log "{{nginx_log_dir}}/access.log"
  - error_log "{{nginx_log_dir}}/error.log"
nginx_sites:
  default:
    upstream_group:
      name: thumbor
      base_string: "server 127.0.0.1:800$#;"
      size: "{{ thumbor_processes }}"
    server:
      - listen 80 default_server
      - keepalive_timeout 5
      - '# Logging to graylog'
      - access_log syslog:server={{nginx_graylog_server}}:12301 graylog2_format
      - error_log syslog:server={{nginx_graylog_server}}:12302
      - '# Fallback logging'
      - access_log {{nginx_log_dir}}/thumbor.access.log
      - error_log {{nginx_log_dir}}/thumbor.error.log
      - location / {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;
        proxy_pass http://thumbor;
        }
      - location {{nginx_status_page}} {
        stub_status on;
        allow 127.0.0.1;
        deny all;
        }

